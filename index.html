<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Mapping Tool</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        canvas {
            border: 1px solid #fff;
            background-color: #000;
        }
        .controls {
            margin-top: 20px;
        }
        .controls input {
            margin: 5px;
        }
        .layer-list {
            margin-top: 10px;
            list-style: none;
            padding: 0;
            text-align: left;
            max-width: 200px;
        }
        .layer-list li {
            margin: 5px 0;
            background: #333;
            padding: 5px;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
        }
        .layer-list button {
            background: #555;
            color: white;
            border: none;
            padding: 2px 5px;
            cursor: pointer;
            border-radius: 3px;
        }
        .layer-list button:hover {
            background: #777;
        }
        .blend-select, .opacity-slider {
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>Web Mapping Tool</h1>
    <canvas id="mappingCanvas" width="800" height="600"></canvas>
    <div class="controls">
        <input type="file" id="upload" accept="video/*,image/*">
        <button id="reset">Reset</button>
        <br>
        <label for="scale">Scale:</label>
        <input type="range" id="scale" min="0.5" max="2" step="0.1" value="1">
        <br>
        <label for="rotation">Rotate:</label>
        <input type="range" id="rotation" min="0" max="360" step="1" value="0">
        <br>
        <button id="addLayer">Add Layer</button>
        <ul class="layer-list" id="layerList"></ul>
    </div>

    <script>
        const canvas = document.getElementById('mappingCanvas');
        const ctx = canvas.getContext('2d');
        const upload = document.getElementById('upload');
        const resetBtn = document.getElementById('reset');
        const scaleInput = document.getElementById('scale');
        const rotationInput = document.getElementById('rotation');
        const addLayerBtn = document.getElementById('addLayer');
        const layerList = document.getElementById('layerList');

        let layers = [];
        let activeLayer = null;

        class Layer {
            constructor(media, scale = 1, rotation = 0, blendMode = 'source-over', opacity = 1) {
                this.media = media;
                this.scale = scale;
                this.rotation = rotation;
                this.blendMode = blendMode;
                this.opacity = opacity;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.opacity;
                ctx.globalCompositeOperation = this.blendMode;
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.scale(this.scale, this.scale);
                ctx.rotate((this.rotation * Math.PI) / 180);
                if (this.media.tagName === 'IMG') {
                    ctx.drawImage(this.media, -this.media.width / 2, -this.media.height / 2);
                } else if (this.media.tagName === 'VIDEO') {
                    ctx.drawImage(this.media, -this.media.videoWidth / 2, -this.media.videoHeight / 2);
                }
                ctx.restore();
            }
        }

        function drawAllLayers() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            layers.forEach(layer => layer.draw());
        }

        upload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                let media;
                if (file.type.startsWith('image/')) {
                    media = new Image();
                    media.onload = () => {
                        addLayer(media);
                    };
                } else if (file.type.startsWith('video/')) {
                    media = document.createElement('video');
                    media.src = url;
                    media.autoplay = true;
                    media.loop = true;
                    media.muted = true;
                    media.onloadeddata = () => {
                        addLayer(media);
                    };
                }
                media.src = url;
            }
        });

        function addLayer(media) {
            const layer = new Layer(media);
            layers.push(layer);
            activeLayer = layer;
            updateLayerList();
            drawAllLayers();
        }

        function updateLayerList() {
            layerList.innerHTML = '';
            layers.forEach((layer, index) => {
                const li = document.createElement('li');
                li.textContent = `Layer ${index + 1}`;
                
                const blendSelect = document.createElement('select');
                blendSelect.className = 'blend-select';
                ['source-over', 'multiply', 'screen', 'overlay', 'darken', 'lighten', 'color-dodge', 'color-burn', 'difference', 'exclusion', 'hue', 'saturation', 'color', 'luminosity'].forEach(mode => {
                    const option = document.createElement('option');
                    option.value = mode;
                    option.textContent = mode;
                    if (layer.blendMode === mode) option.selected = true;
                    blendSelect.appendChild(option);
                });
                blendSelect.addEventListener('change', (e) => {
                    layer.blendMode = e.target.value;
                    drawAllLayers();
                });

                const opacitySlider = document.createElement('input');
                opacitySlider.type = 'range';
                opacitySlider.min = 0;
                opacitySlider.max = 1;
                opacitySlider.step = 0.1;
                opacitySlider.value = layer.opacity;
                opacitySlider.className = 'opacity-slider';
                opacitySlider.addEventListener('input', (e) => {
                    layer.opacity = parseFloat(e.target.value);
                    drawAllLayers();
                });

                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.addEventListener('click', () => {
                    layers.splice(index, 1);
                    updateLayerList();
                    drawAllLayers();
                });
                
                li.appendChild(blendSelect);
                li.appendChild(opacitySlider);
                li.appendChild(deleteBtn);
                layerList.appendChild(li);
            });
        }

        resetBtn.addEventListener('click', () => {
            layers = [];
            activeLayer = null;
            scaleInput.value = 1;
            rotationInput.value = 0;
            updateLayerList();
            drawAllLayers();
        });

        scaleInput.addEventListener('input', (event) => {
            if (activeLayer) {
                activeLayer.scale = parseFloat(event.target.value);
                drawAllLayers();
            }
        });

        rotationInput.addEventListener('input', (event) => {
            if (activeLayer) {
                activeLayer.rotation = parseFloat(event.target.value);
                drawAllLayers();
            }
        });

        addLayerBtn.addEventListener('click', () => {
            if (activeLayer) {
                layers.push(new Layer(activeLayer.media, activeLayer.scale, activeLayer.rotation));
                updateLayerList();
                drawAllLayers();
            }
        });

        function animate() {
            drawAllLayers();
            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
